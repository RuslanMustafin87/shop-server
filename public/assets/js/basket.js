(()=>{"use strict";var t,e={629:(t,e,n)=>{var r=n(861),a=n(757),o=n.n(a),c=JSON.parse('{"p":3000,"J":"http://92.53.105.229"}'),i=n(344),s=new(n(803).Z),d=document.forms.formOrder;d.addEventListener("submit",(function(t){t.preventDefault();var e=Array.from(document.querySelectorAll(".product")),n=[],r=0;e.forEach((function(t){r+=parseInt(t.dataset.price.replace(/\D/g,"")),n.push(t.dataset.id)})),fetch("".concat(c.J,":").concat(c.p,"/basket/addorder"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({name:d.name.value,phone:d.phone.value,total:r,productList:n})}).then((function(t){t.json(),d.reset()})).then((function(t){return s.start(t.message)})).catch((function(t){return s.start(t.message)}))}));var u=new i.Z,l=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB",useGrouping:!0,maximumFractionDigits:0}),p=document.getElementById("button-reset"),f=document.getElementById("products"),g=document.getElementById("total-sum");function v(t){var e,n;t.forEach((function(t){var e=m(t);f.append(e)})),g.innerHTML=(e=t,n=0,(e=Array.from(e)).forEach((function(t){n+=+t.price})),l.format(n))}function m(t){console.log(t);var e=document.createElement("li");e.classList.add("product","products__item"),e.dataset.id=t._id,e.dataset.name=t.name,e.dataset.price=t.price;var n=new Blob([new Uint8Array(t.image.data)],{type:"image/jpeg"}),r=URL.createObjectURL(n);return e.insertAdjacentHTML("beforeend","<a class='product__link' href='/product?id=".concat(t._id,"'> \t\t\t<img class='product__image' src='").concat(r,"'> \t\t</a> \t\t<ul class='product__rating rating'> \t\t\t<li class='rating__star' data-rating='").concat(5==t.rating.roundedRating||void 0,"'> \t\t\t<li class='rating__star' data-rating='").concat(4==t.rating.roundedRating||void 0,"'> \t\t\t<li class='rating__star' data-rating='").concat(3==t.rating.roundedRating||void 0,"'> \t\t\t<li class='rating__star' data-rating='").concat(2==t.rating.roundedRating||void 0,"'> \t\t\t<li class='rating__star' data-rating='").concat(1==t.rating.roundedRating||void 0,"'> \t\t</ul> \t\t<h1 class='product__name'>").concat(t.name,"</h1> \t\t<span class='product__price'>").concat(t.price,"</span> \t\t<button class='product__button-delete'>Удалить</button>")),e}function h(){return(h=(0,r.Z)(o().mark((function t(e){var n,r,a,i,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=JSON.parse(e),r=n[n.length-1],console.log(r),t.prev=3,t.next=6,fetch("".concat(c.J,":").concat(c.p,"/basket/getproducts?id=").concat(r.id));case 6:return i=t.sent,t.next=9,i.json();case 9:a=t.sent,t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),console.error(t.t0);case 15:s=m(a[0]),f.firstElementChild||(f.innerHTML=""),f.append(s),g.innerHTML=l.format(+g.innerHTML.replace(/\D/g,"")+ +a[0].price);case 19:case"end":return t.stop()}}),t,null,[[3,12]])})))).apply(this,arguments)}f.addEventListener("click",(function(t){var e=t.target.closest(".product__button-delete");if(e){var n=e.closest("li");return u.deleteProductFromBasket(n.dataset.id),g.innerHTML=l.format(g.innerHTML.replace(/\D/g,"")-n.dataset.price),n.remove(),f.firstChild?void 0:(f.innerHTML="Корзина пуста",void(g.innerHTML="0 &#8381"))}})),p.addEventListener("click",(function(){!function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(f),u.resetBasket(),f.innerHTML="Корзина пуста",g.innerHTML="0 &#8381"})),document.addEventListener("DOMContentLoaded",(0,r.Z)(o().mark((function t(){var e,n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=u.getProductsFromBasket()){t.next=5;break}return f.innerHTML="Корзина пуста",g.innerHTML="0 &#8381",t.abrupt("return");case 5:return n=[],t.prev=6,t.next=9,fetch("".concat(c.J,":").concat(c.p,"/basket/getproducts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});case 9:return r=t.sent,t.next=12,r.json();case 12:n=t.sent,t.next=18;break;case 15:t.prev=15,t.t0=t.catch(6),console.log(t.t0);case 18:v(n);case 19:case"end":return t.stop()}}),t,null,[[6,15]])})))),window.addEventListener("storage",(function(t){t.newValue&&function(t){h.apply(this,arguments)}(t.newValue)}))}},n={};function r(t){var a=n[t];if(void 0!==a)return a.exports;var o=n[t]={exports:{}};return e[t](o,o.exports,r),o.exports}r.m=e,t=[],r.O=(e,n,a,o)=>{if(!n){var c=1/0;for(u=0;u<t.length;u++){n=t[u][0],a=t[u][1],o=t[u][2];for(var i=!0,s=0;s<n.length;s++)(!1&o||c>=o)&&Object.keys(r.O).every((t=>r.O[t](n[s])))?n.splice(s--,1):(i=!1,o<c&&(c=o));if(i){t.splice(u--,1);var d=a();void 0!==d&&(e=d)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[n,a,o]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.j=130,(()=>{var t={130:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var a,o,c=n[0],i=n[1],s=n[2],d=0;if(c.some((e=>0!==t[e]))){for(a in i)r.o(i,a)&&(r.m[a]=i[a]);if(s)var u=s(r)}for(e&&e(n);d<c.length;d++)o=c[d],r.o(t,o)&&t[o]&&t[o][0](),t[c[d]]=0;return r.O(u)},n=self.webpackChunktest=self.webpackChunktest||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var a=r.O(void 0,[592],(()=>r(629)));a=r.O(a)})();