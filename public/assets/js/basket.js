(()=>{"use strict";var t,e={629:(t,e,n)=>{var r=n(861),a=n(757),i=n.n(a),c=JSON.parse('{"p":3007,"J":"http://localhost"}'),o=n(344),s=new(n(803).Z),u=document.forms.formOrder;u.addEventListener("submit",(function(t){t.preventDefault();var e=Array.from(document.querySelectorAll(".product")),n=[],r=0;e.forEach((function(t){r+=parseInt(t.dataset.price),n.push(t.dataset.id)})),fetch("".concat(c.J,":").concat(c.p,"/basket/addorder"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({name:u.name.value,phone:u.phone.value,total:r,productList:n})}).then((function(t){return u.reset(),t.json()})).then((function(t){return s.start(t.message)})).catch((function(t){return s.start(t.message)}))})),window.addEventListener("DOMContentLoaded",(function(){function t(t){var e="+7 (___) ___ ____",n=0,r=e.replace(/\D/g,""),a=this.value.replace(/\D/g,"");r.length>=a.length&&(a=r),this.value=e.replace(/./g,(function(t){return/[_\d]/.test(t)&&n<a.length?a.charAt(n++):n>=a.length?"":t})),"blur"===t.type?2===this.value.length&&(this.value=""):function(t,e){if(e.focus(),e.setSelectionRange)e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}(this.value.length,this)}var e=document.getElementById("phone");e.addEventListener("input",t,!1),e.addEventListener("focus",t,!1),e.addEventListener("blur",t,!1)}));var d=new o.Z,l=document.getElementById("button-reset"),p=document.getElementById("products"),g=document.getElementById("total-sum");function f(t){var e,n;t.forEach((function(t){var e=m(t);p.append(e)})),g.innerHTML=(e=t,n=0,(e=Array.from(e)).forEach((function(t){n+=+t.price})),n.toLocaleString("ru-RU",{style:"currency",currency:"RUB",useGrouping:!0,maximumFractionDigits:0,minimumFractionDigits:0}))}function m(t){var e=document.createElement("li");e.classList.add("product","products__item"),e.dataset.id=t._id,e.dataset.name=t.name,e.dataset.price=t.price;var n=new Blob([new Uint8Array(t.image.data)],{type:"image/jpeg"}),r=URL.createObjectURL(n);return e.insertAdjacentHTML("beforeend","<a class='product__link' href='/product?id=".concat(t._id,"'> \t\t\t<img class='product__image' src='").concat(r,"'> \t\t</a> \t\t<ul class='product__rating rating'> \t\t\t<li class='rating__star' data-rating='").concat(5==t.rating.roundedRating||void 0,"'> \t\t\t<li class='rating__star' data-rating='").concat(4==t.rating.roundedRating||void 0,"'> \t\t\t<li class='rating__star' data-rating='").concat(3==t.rating.roundedRating||void 0,"'> \t\t\t<li class='rating__star' data-rating='").concat(2==t.rating.roundedRating||void 0,"'> \t\t\t<li class='rating__star' data-rating='").concat(1==t.rating.roundedRating||void 0,"'> \t\t</ul> \t\t<h1 class='product__name'>").concat(t.name,"</h1> \t\t<span class='product__price'>").concat(t.priceIntl,"</span> \t\t<button class='product__button-delete'>Удалить</button>")),e}function v(){return(v=(0,r.Z)(i().mark((function t(e){var n,r,a,o,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=JSON.parse(e),r=n[n.length-1],t.prev=2,t.next=5,fetch("".concat(c.J,":").concat(c.p,"/basket/getproducts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([r])});case 5:return o=t.sent,t.next=8,o.json();case 8:a=t.sent,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.error(t.t0);case 14:s=m(a[0]),p.firstElementChild||(p.innerHTML=""),p.append(s),g.innerHTML=(+g.innerHTML.replace(/\D/g,"")+ +a[0].price).toLocaleString("ru-RU",{style:"currency",currency:"RUB",useGrouping:!0,maximumFractionDigits:0,minimumFractionDigits:0});case 18:case"end":return t.stop()}}),t,null,[[2,11]])})))).apply(this,arguments)}p.addEventListener("click",(function(t){var e=t.target.closest(".product__button-delete");if(e){var n=e.closest("li");return d.deleteProductFromBasket(n.dataset.id),g.innerHTML=(g.innerHTML.replace(/\D/g,"")-n.dataset.price).toLocaleString("ru-RU",{style:"currency",currency:"RUB",useGrouping:!0,maximumFractionDigits:0,minimumFractionDigits:0}),n.remove(),p.firstChild?void 0:(p.innerHTML="Корзина пуста",void(g.innerHTML="0 &#8381"))}})),l.addEventListener("click",(function(){!function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(p),d.resetBasket(),p.innerHTML="Корзина пуста",g.innerHTML="0 &#8381"})),document.addEventListener("DOMContentLoaded",(0,r.Z)(i().mark((function t(){var e,n,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=d.getProductsFromBasket()){t.next=5;break}return p.innerHTML="Корзина пуста",g.innerHTML="0 &#8381",t.abrupt("return");case 5:return n=[],t.prev=6,t.next=9,fetch("".concat(c.J,":").concat(c.p,"/basket/getproducts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});case 9:return r=t.sent,t.next=12,r.json();case 12:n=t.sent,t.next=18;break;case 15:t.prev=15,t.t0=t.catch(6),console.log(t.t0);case 18:f(n);case 19:case"end":return t.stop()}}),t,null,[[6,15]])})))),window.addEventListener("storage",(function(t){t.newValue&&function(t){v.apply(this,arguments)}(t.newValue)}))}},n={};function r(t){var a=n[t];if(void 0!==a)return a.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.m=e,t=[],r.O=(e,n,a,i)=>{if(!n){var c=1/0;for(d=0;d<t.length;d++){n=t[d][0],a=t[d][1],i=t[d][2];for(var o=!0,s=0;s<n.length;s++)(!1&i||c>=i)&&Object.keys(r.O).every((t=>r.O[t](n[s])))?n.splice(s--,1):(o=!1,i<c&&(c=i));if(o){t.splice(d--,1);var u=a();void 0!==u&&(e=u)}}return e}i=i||0;for(var d=t.length;d>0&&t[d-1][2]>i;d--)t[d]=t[d-1];t[d]=[n,a,i]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.j=130,(()=>{var t={130:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var a,i,c=n[0],o=n[1],s=n[2],u=0;if(c.some((e=>0!==t[e]))){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(s)var d=s(r)}for(e&&e(n);u<c.length;u++)i=c[u],r.o(t,i)&&t[i]&&t[i][0](),t[c[u]]=0;return r.O(d)},n=self.webpackChunktest=self.webpackChunktest||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var a=r.O(void 0,[592],(()=>r(629)));a=r.O(a)})();