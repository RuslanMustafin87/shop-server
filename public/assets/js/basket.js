(()=>{"use strict";var e,t={629:(e,t,n)=>{var r=n(861),a=n(757),c=n.n(a),o=JSON.parse('{"p":3007,"J":"http://localhost"}'),i=n(690),s=new(n(803).Z),d=document.forms.formOrder;d.addEventListener("submit",(function(e){e.preventDefault();var t=Array.from(document.querySelectorAll(".product")),n=[],r=0;t.forEach((function(e){r+=parseInt(e.dataset.price.replace(/\D/g,"")),n.push(e.dataset.id)})),fetch("".concat(o.J,":").concat(o.p,"/api/orders/addorder"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({name:d.name.value,phone:d.phone.value,total:r,productList:n})}).then((function(e){e.json(),d.reset()})).then((function(e){return s.start(e.message)})).catch((function(e){return s.start(e.message)}))}));var u=new i.Z,p=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB",useGrouping:!0,maximumFractionDigits:0}),l=document.getElementById("button-reset"),m=document.getElementById("products"),f=document.getElementById("total-sum");function v(e){var t,n;e.forEach((function(e){var t=h(e);m.append(t)})),f.innerHTML=(t=e,n=0,(t=Array.from(t)).forEach((function(e){n+=+e.price.replace(/\D/g,"")})),p.format(n))}function h(e){var t=document.createElement("li"),n=document.createElement("a"),r=document.createElement("img"),a=document.createElement("ul"),c=document.createElement("li"),o=document.createElement("h1"),i=document.createElement("span"),s=document.createElement("button");t.classList.add("product","products__item"),n.classList.add("product__link"),r.classList.add("product__image"),a.classList.add("product__rating","rating"),c.classList.add("rating__star"),o.classList.add("product__name"),i.classList.add("product__price"),s.classList.add("product__button-delete"),s.innerHTML="Удалить";var d=new Blob([new Uint8Array(e.image.data)],{type:"image/jpeg"});r.src=URL.createObjectURL(d),n.href="/product?id=".concat(e._id);for(var u=0;u<5;u++)a.append(c.cloneNode(!0));return e.rating.roundedRating&&Array.from(a.children)[5-e.rating.roundedRating].setAttribute("data-rating","true"),o.innerHTML=e.name,i.innerHTML=e.price,t.dataset.id=e._id,t.dataset.name=e.name,t.dataset.price=e.price,n.append(r),t.append(n),t.append(a),t.append(o),t.append(i),t.append(s),t}function g(){return(g=(0,r.Z)(c().mark((function e(t){var n,r,a,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(t),r=n[n.length-1],e.prev=2,e.next=5,fetch("".concat(o.J,":").concat(o.p,"/basket/getimages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([r])});case 5:return i=e.sent,e.next=8,i.json();case 8:a=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.error(e.t0);case 14:s=h(a[0]),m.firstElementChild||(m.innerHTML=""),m.append(s),f.innerHTML=p.format(+f.innerHTML.replace(/\D/g,"")+ +a[0].price);case 18:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}m.addEventListener("click",(function(e){var t=e.target.closest(".product__button-delete");if(t){var n=t.closest("li");return u.deleteProductFromBasket(n.dataset.id),f.innerHTML=p.format(f.innerHTML.replace(/\D/g,"")-n.dataset.price.replace(/\D/g,"")),n.remove(),m.firstChild?void 0:(m.innerHTML="Корзина пуста",void(f.innerHTML="0 &#8381"))}})),l.addEventListener("click",(function(){!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(m),u.resetBasket(),m.innerHTML="Корзина пуста",f.innerHTML="0 &#8381"})),document.addEventListener("DOMContentLoaded",(0,r.Z)(c().mark((function e(){var t,n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.getProductsFromBasket()){e.next=5;break}return m.innerHTML="Корзина пуста",f.innerHTML="0 &#8381",e.abrupt("return");case 5:return n=[],e.prev=6,e.next=9,fetch("".concat(o.J,":").concat(o.p,"/basket/getimages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 9:return r=e.sent,e.next=12,r.json();case 12:n=e.sent,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(6),console.log(e.t0);case 18:v(n);case 19:case"end":return e.stop()}}),e,null,[[6,15]])})))),window.addEventListener("storage",(function(e){e.newValue&&function(e){g.apply(this,arguments)}(e.newValue)}))}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var c=n[e]={exports:{}};return t[e](c,c.exports,r),c.exports}r.m=t,e=[],r.O=(t,n,a,c)=>{if(!n){var o=1/0;for(u=0;u<e.length;u++){n=e[u][0],a=e[u][1],c=e[u][2];for(var i=!0,s=0;s<n.length;s++)(!1&c||o>=c)&&Object.keys(r.O).every((e=>r.O[e](n[s])))?n.splice(s--,1):(i=!1,c<o&&(o=c));if(i){e.splice(u--,1);var d=a();void 0!==d&&(t=d)}}return t}c=c||0;for(var u=e.length;u>0&&e[u-1][2]>c;u--)e[u]=e[u-1];e[u]=[n,a,c]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.j=130,(()=>{var e={130:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var a,c,o=n[0],i=n[1],s=n[2],d=0;if(o.some((t=>0!==e[t]))){for(a in i)r.o(i,a)&&(r.m[a]=i[a]);if(s)var u=s(r)}for(t&&t(n);d<o.length;d++)c=o[d],r.o(e,c)&&e[c]&&e[c][0](),e[o[d]]=0;return r.O(u)},n=self.webpackChunktest=self.webpackChunktest||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=r.O(void 0,[592],(()=>r(629)));a=r.O(a)})();